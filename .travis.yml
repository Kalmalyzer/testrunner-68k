
__common: &common
  # language: rust
  # rust: stable
  # cache: cargo
  language: c

matrix:

  include:
  # - <<: *common
  #   os: linux
  #   dist: xenial
    
  #   script:
  #   # Build Tundra from source & install
  #   - git clone --recursive https://github.com/deplinenoise/tundra.git
  #   - cd tundra
  #   - make
  #   - sudo make install
  #   - cd ..

  #   # Build Musashi
  #   - tundra2

  #   # Run testrunner-68k tests
  #   - cargo test

  - <<: *common
    os: windows

    before_install:
    # Fetch Tundra installer
    - cmd.exe /C 'start /wait wget https://github.com/deplinenoise/tundra/releases/download/v2.09/Tundra-Setup.exe'
    # Run Tundra installer
    - cmd.exe /C 'start /wait Tundra-Setup.exe /S'
    # Add Tundra binary path to current install path (as the installer does not refresh the current shell's env vars)
    - PATH="$PATH:/c/Program Files/Tundra 2.0/bin"

    # Setup VC environment variables. We assume that VS 2017 is already installed on the machine.
    - cl.exe
    - '"/c/Program Files (x86)/Microsoft Visual Studio/2017/BuildTools/VC/Auxiliary/Build/vcvarsall.bat" amd64'
    - cl.exe

    script:

    # Build Musashi
    - tundra2

    # Run testrunner-68k tests
    - cargo test
